\clearpage

\section{Simulation Analysis}
\label{sec:simulation}

We started out by doing a simulation analysis of the circuit that was present above. The OP-AMP used is a subcircuit composed of of 2 capacitors, 5 diodes, a voltage-controled voltage source, a current-controlled current source, 2 voltage-controlled current sources, an independent current source, a current-controled voltage source, 2 transistors, 9 resistors and 6 independent voltage sources, making it an OP-AMP in the model uA741.

In Figure \ref{fig:sim-gain}, the result for the gain for various frequencies is presented.

\vspace{-3cm}

\begin{figure}[H] \centering
\includegraphics[width=0.5\linewidth]{../sim/gain.pdf}
\caption{Output Voltage Gain Simulated}
\label{fig:sim-gain}
\end{figure}

It is obvious that we were able to come quite close to the requested gain, but our central frequency is not the desired one. In the tables below the relevant results from the the graph in Figure \ref{fig:sim-gain} are presented, which lets us know that the higher cut-off frequency is actually very close to the desired central frequency, which means that our gain is still mostly relevant at 1000Hz.

\begin{center}
\begin{tabular}{|l|r|}
  \hline    
  {\bf Variable} & {\bf Value (dB)} \\ \hline
  \input{../sim/gain_tab.tex}
  %\label{tab:gain-tab}
\end{tabular}
\end{center}

\begin{center}
\begin{tabular}{|l|r|}
  \hline    
  {\bf Variable} & {\bf Value (Hz)} \\ \hline
  \input{../sim/frequencies_tab.tex}
 % \label{tab:freq-tab}
\end{tabular}
\end{center}

In Figure \ref{fig:sim-phase}, you are also able to see the phase of the circuit throughout the same range of frequencies.

\begin{figure}[H] \centering
\includegraphics[width=0.5\linewidth]{../sim/phase.pdf}
\caption{Simulated Phase}
\label{fig:sim-phase}
\end{figure}

The discontinuance at around 10$^5$Hz is due to the fact that \textit{Ngspice}, the \textit{software} that was used for the simulation, automatically makes it so the values showed for the phase angle are between $\pi$ and -$\pi$, which lead to that. 

Another interesting results, which will be useful later on for comparing with the theoretical analysis results, are the input and output impedances. The input impedance is directly taken from dividing the voltage in the input node by the current going through it in the original circuit.

\begin{center}
\begin{tabular}{|l|r|}
  \hline    
  {\bf Variable} & {\bf Value ($\Omega$)} \\ \hline
  \input{../sim/zin_tab.tex}
\end{tabular}
\end{center}

For us to be able to calculate the output impedance, we had to create a new circuit, similar to the original one. However, in this new circuit, that is displayed in Figure \ref{fig:circuit-out}, we have turned off the input voltage source and used it as a test source connected to the output terminals.

\begin{figure}[H] \centering
\includegraphics[width=0.7\linewidth]{circuit-out.pdf}
\caption{The circuit used to calculate the output impedance.}
\label{fig:circuit-out}
\end{figure}

The value obtained for the output impedance is presented in the table below, calculated by measuring the voltage in the output terminal and, once again, dividing it by the current going through it -- the test source is used to measure this current.

\begin{center}
\begin{tabular}{|l|r|}
  \hline    
  {\bf Variable} & {\bf Value ($\Omega$)} \\ \hline
  \input{../sim/zout_tab.tex}
\end{tabular}
\end{center}

Some last final interesting values are the cost of the whole circuit, in the first table below, and the merit, in the second one.

\begin{center}
\begin{tabular}{|l|r|}
  \hline    
  {\bf Variable} & {\bf Value (MU)} \\ \hline
  \input{../sim/cost_tab.tex}
\end{tabular}
\end{center}

\begin{center}
\begin{tabular}{|l|r|}
  \hline    
  {\bf Variable} & {\bf Value} \\ \hline
  \input{../sim/merit_tab.tex}
\end{tabular}
\end{center}